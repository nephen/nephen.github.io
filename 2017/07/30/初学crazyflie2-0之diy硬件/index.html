<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="crazyflie,">










<meta name="description" content="JLinkGDBServer调试添加JLink到STM32F405RG，确保Vsupply接口存在电压。打开服务器端，这是arm-none-eabi-gdb调试的后台，如下。 123456789101112131415161718192021222324252627282930313233343536373839JLinkGDBServer -if SWD -device STM32F405RGS">
<meta name="keywords" content="crazyflie">
<meta property="og:type" content="article">
<meta property="og:title" content="初学crazyflie2.0之diy硬件">
<meta property="og:url" content="http://nephen.cn/2017/07/30/初学crazyflie2-0之diy硬件/index.html">
<meta property="og:site_name" content="来风的官方网站">
<meta property="og:description" content="JLinkGDBServer调试添加JLink到STM32F405RG，确保Vsupply接口存在电压。打开服务器端，这是arm-none-eabi-gdb调试的后台，如下。 123456789101112131415161718192021222324252627282930313233343536373839JLinkGDBServer -if SWD -device STM32F405RGS">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-11-23T01:38:49.387Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="初学crazyflie2.0之diy硬件">
<meta name="twitter:description" content="JLinkGDBServer调试添加JLink到STM32F405RG，确保Vsupply接口存在电压。打开服务器端，这是arm-none-eabi-gdb调试的后台，如下。 123456789101112131415161718192021222324252627282930313233343536373839JLinkGDBServer -if SWD -device STM32F405RGS">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://nephen.cn/2017/07/30/初学crazyflie2-0之diy硬件/">





  <title>初学crazyflie2.0之diy硬件 | 来风的官方网站</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">来风的官方网站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nephen.cn/2017/07/30/初学crazyflie2-0之diy硬件/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nephen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="来风的官方网站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">初学crazyflie2.0之diy硬件</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-30T10:15:11+08:00">
                2017-07-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/飞控/" itemprop="url" rel="index">
                    <span itemprop="name">飞控</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="JLinkGDBServer调试"><a href="#JLinkGDBServer调试" class="headerlink" title="JLinkGDBServer调试"></a>JLinkGDBServer调试</h1><p>添加JLink到STM32F405RG，确保Vsupply接口存在电压。打开服务器端，这是arm-none-eabi-gdb调试的后台，如下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">JLinkGDBServer -<span class="keyword">if</span> SWD -device STM32F405RG</span><br><span class="line"></span><br><span class="line">SEGGER J-Link GDB Server V5.12g Command Line Version</span><br><span class="line"></span><br><span class="line">JLinkARM.dll V5.12g (DLL compiled May 27 2016 17:03:38)</span><br><span class="line"></span><br><span class="line">-----GDB Server start settings-----</span><br><span class="line">GDBInit file:                  none</span><br><span class="line">GDB Server Listening port:     2331</span><br><span class="line">SWO raw output listening port: 2332</span><br><span class="line">Terminal I/O port:             2333</span><br><span class="line">Accept remote connection:      yes</span><br><span class="line">Generate logfile:              off</span><br><span class="line">Verify download:               off</span><br><span class="line">Init regs on start:            off</span><br><span class="line">Silent mode:                   off</span><br><span class="line">Single run mode:               off</span><br><span class="line">Target connection timeout:     0 ms</span><br><span class="line">------J-Link related settings------</span><br><span class="line">J-Link Host interface:         USB</span><br><span class="line">J-Link script:                 none</span><br><span class="line">J-Link settings file:          none</span><br><span class="line">------Target related settings------</span><br><span class="line">Target device:                 STM32F405RG</span><br><span class="line">Target interface:              SWD</span><br><span class="line">Target interface speed:        1000kHz</span><br><span class="line">Target endian:                 little</span><br><span class="line"></span><br><span class="line">Connecting to J-Link...</span><br><span class="line">J-Link is connected.</span><br><span class="line">Firmware: J-Link ARM V8 compiled Nov 28 2014 13:44:46</span><br><span class="line">Hardware: V8.00</span><br><span class="line">S/N: 20121126</span><br><span class="line">Feature(s): RDI,FlashDL,FlashBP,JFlash</span><br><span class="line">Checking target voltage...</span><br><span class="line">Target voltage: 3.31 V</span><br><span class="line">Listening on TCP/IP port 2331</span><br><span class="line">Connecting to target...Connected to target</span><br><span class="line">Waiting <span class="keyword">for</span> GDB connection...</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="开始GDB调试"><a href="#开始GDB调试" class="headerlink" title="开始GDB调试"></a>开始GDB调试</h1><p>注意如下，在用户目录下面创建.gdbinit文件。<br>To enable execution of this file add<br>    add-auto-load-safe-path /home/nephne/src/Bootloader/.gdbinit<br>line to your configuration file “/home/nephne/.gdbinit”.</p>
<p>编写<code>工程目录</code>下面的.gdbinit文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">target remote :2331</span><br><span class="line"><span class="built_in">set</span> mem inaccessible-by-default off </span><br><span class="line">monitor speed auto</span><br><span class="line">monitor endian little</span><br><span class="line">monitor reset</span><br><span class="line">monitor flash device = STM32F405RG</span><br><span class="line">monitor flash breakpoints = 1 </span><br><span class="line">monitor flash download = 1 </span><br><span class="line">load</span><br><span class="line">monitor reg sp = (0x08000000)</span><br><span class="line">monitor reg pc = (0x08000004)</span><br><span class="line"><span class="built_in">break</span> main</span><br><span class="line">layout src</span><br><span class="line"><span class="comment"># 可以使用next 1000运行到断点main处</span></span><br></pre></td></tr></table></figure>
<p>运行命令如下，即可运行gdb的相关命令，如next，step，continue等等，其中layout src为显示源代码窗口。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-none-eabi-gdb build_crazyflie_bl/crazyflie_bl.elf</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="下载代码"><a href="#下载代码" class="headerlink" title="下载代码"></a>下载代码</h1><p>更新bootloader除了使用JLink也可以使用dfu-util工具。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">sudo dfu-util -d 0483:df11 -a 0 -s 0x08000000 -D crazyflie_bl.bin</span><br><span class="line"></span><br><span class="line">GNU gdb (GNU Tools <span class="keyword">for</span> ARM Embedded Processors) 7.6.0.20140731-cvs</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">"show copying"</span></span><br><span class="line">and <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"--host=i686-linux-gnu --target=arm-none-eabi"</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">Reading symbols from /home/nephne/src/Bootloader/crazyflie_bl.elf...done.</span><br><span class="line">reset_handler () at ../../cm3/vector.c:67</span><br><span class="line">67		<span class="keyword">for</span> (src = &amp;_data_loadaddr, dest = &amp;_data;</span><br><span class="line">Select auto target interface speed (2000 kHz)</span><br><span class="line">Target endianess <span class="built_in">set</span> to <span class="string">"little endian"</span></span><br><span class="line">Resetting target</span><br><span class="line">Selecting device: STM32F405RG</span><br><span class="line">Flash breakpoints enabled</span><br><span class="line">Flash download enabled</span><br><span class="line">Loading section .text, size 0x2204 lma 0x8000000</span><br><span class="line">Loading section .data, size 0x54 lma 0x8002204</span><br><span class="line">Start address 0x8000000, load size 8792</span><br><span class="line">Transfer rate: 8585 KB/sec, 4396 bytes/write.</span><br><span class="line">Writing register (SP = 0x20020000)</span><br><span class="line">Writing register (PC = 0x080018BD)</span><br><span class="line">Breakpoint 1 at 0x8000b40: file main_f4.c, line 687.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>如果想在下载时看到灯闪烁，需要修改bootloader源码，因为买的开发板与原版crazyflie原理图还是有差异的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> #</span><br><span class="line"> # Submodule management</span><br><span class="line"> #</span><br><span class="line">diff --git a/hw_config.h b/hw_config.h</span><br><span class="line">index dd271d3.<span class="number">.234</span>f7d0 <span class="number">100644</span></span><br><span class="line">--- a/hw_config.h</span><br><span class="line">+++ b/hw_config.h</span><br><span class="line">@@ <span class="number">-511</span>,<span class="number">8</span> +<span class="number">511</span>,<span class="number">8</span> @@</span><br><span class="line"> </span><br><span class="line"> <span class="meta"># <span class="meta-keyword">define</span> OSC_FREQ                       8</span></span><br><span class="line">-<span class="meta"># <span class="meta-keyword">define</span> BOARD_PIN_LED_ACTIVITY         GPIO0</span></span><br><span class="line">-<span class="meta"># <span class="meta-keyword">define</span> BOARD_PIN_LED_BOOTLOADER       GPIO2</span></span><br><span class="line">+<span class="meta"># <span class="meta-keyword">define</span> BOARD_PIN_LED_ACTIVITY         GPIO5</span></span><br><span class="line">+<span class="meta"># <span class="meta-keyword">define</span> BOARD_PIN_LED_BOOTLOADER       GPIO5</span></span><br><span class="line">diff --git a/main_f4.c b/main_f4.c</span><br><span class="line">index <span class="number">4b</span>25c99.<span class="number">.289e655</span> <span class="number">100644</span></span><br><span class="line">--- a/main_f4.c</span><br><span class="line">+++ b/main_f4.c</span><br><span class="line">@@ <span class="number">-636</span>,<span class="number">7</span> +<span class="number">636</span>,<span class="number">7</span> @@ flash_func_read_sn(<span class="keyword">uint32_t</span> address)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">void</span></span><br><span class="line">-led_on(<span class="keyword">unsigned</span> led)</span><br><span class="line">+led_off(<span class="keyword">unsigned</span> led)</span><br><span class="line"> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (led) &#123;</span><br><span class="line">        <span class="keyword">case</span> LED_ACTIVITY:</span><br><span class="line">@@ <span class="number">-650</span>,<span class="number">7</span> +<span class="number">650</span>,<span class="number">7</span> @@ led_on(<span class="keyword">unsigned</span> led)</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">void</span></span><br><span class="line">-led_off(<span class="keyword">unsigned</span> led)</span><br><span class="line">+led_on(<span class="keyword">unsigned</span> led)</span><br><span class="line"> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (led) &#123;</span><br><span class="line">        <span class="keyword">case</span> LED_ACTIVITY:</span><br><span class="line">@@ <span class="number">-709</span>,<span class="number">6</span> +<span class="number">709</span>,<span class="number">9</span> @@ main(<span class="keyword">void</span>)</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="更新固件"><a href="#更新固件" class="headerlink" title="更新固件"></a>更新固件</h1><p>更新固件，官网的方式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make crazyflie_default upload</span><br></pre></td></tr></table></figure>
<p>但我的板子连接不上串口，改写源代码Firmware/Tools/px_uploader.py如下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@@ -450,10 +450,10 @@ class uploader(object):</span><br><span class="line">                         msg = <span class="string">"Firmware not suitable for this board (board_type=%u board_id=%u)"</span> % (</span><br><span class="line">                                 self.board_type, fw.property(<span class="string">'board_id'</span>))</span><br><span class="line">                         <span class="built_in">print</span>(<span class="string">"WARNING: %s"</span> % msg)</span><br><span class="line">-                        <span class="keyword">if</span> args.force:</span><br><span class="line">-                                <span class="built_in">print</span>(<span class="string">"FORCED WRITE, FLASHING ANYWAY!"</span>)</span><br><span class="line">-                        <span class="keyword">else</span>:</span><br><span class="line">-                                raise IOError(msg)</span><br><span class="line">+                        <span class="comment">#if args.force:</span></span><br><span class="line">+                        <span class="built_in">print</span>(<span class="string">"FORCED WRITE, FLASHING ANYWAY!"</span>)</span><br><span class="line">+                        <span class="comment">#else:</span></span><br><span class="line">+                        <span class="comment">#        raise IOError(msg)</span></span><br><span class="line">                 <span class="keyword">if</span> self.fw_maxsize &lt; fw.property(<span class="string">'image_size'</span>):</span><br><span class="line">                         raise RuntimeError(<span class="string">"Firmware image is too large for this board"</span>)</span><br><span class="line"> <span class="comment"># Spin waiting for a device to show up</span></span><br><span class="line"> try:</span><br><span class="line">@@ -563,10 +564,12 @@ try:</span><br><span class="line">                             portlist += glob.glob(pattern)</span><br><span class="line">             <span class="keyword">else</span>:</span><br><span class="line">                     portlist = patterns</span><br><span class="line"> </span><br><span class="line">-            <span class="keyword">for</span> port <span class="keyword">in</span> portlist:</span><br><span class="line">-</span><br><span class="line">-                    <span class="comment">#print("Trying %s" % port)</span></span><br><span class="line">+       </span><br><span class="line">+            <span class="keyword">for</span> port <span class="keyword">in</span> patterns:</span><br><span class="line">+                   port = <span class="string">"/dev/serial/by-id/pci-Bitcraze_AB_Crazyflie_BL_0-if00"</span></span><br><span class="line">+                    <span class="built_in">print</span>(<span class="string">"Trying %s"</span> % port)</span><br><span class="line"> </span><br><span class="line">                     <span class="comment"># create an uploader attached to the port</span></span><br><span class="line">                     try:</span><br></pre></td></tr></table></figure>
<p>其中/dev/serial/by-id/pci-Bitcraze_AB_Crazyflie_BL_0-if00为串口id，是在 usb_cinit(void) 函数里被设定的，如下，具体见usb_strings的定义，有# define USBMFGSTRING “Bitcraze AB”。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">usbd_dev = usbd_init(&amp;otgfs_usb_driver, &amp;dev, &amp;config, usb_strings, NUM_USB_STRINGS,</span><br><span class="line">                              usbd_control_buffer, <span class="keyword">sizeof</span>(usbd_control_buffer));</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *usb_strings[] = &#123; </span><br><span class="line">        USBMFGSTRING, <span class="comment">/* Maps to Index 1 Index */</span></span><br><span class="line">        USBDEVICESTRING,</span><br><span class="line">        <span class="string">"0"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> USBMFGSTRING                   <span class="meta-string">"Bitcraze AB"</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> USBDEVICESTRING                <span class="meta-string">"Crazyflie BL"</span></span></span><br></pre></td></tr></table></figure>
<p>最后更新固件成功后为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Found board c,0 bootloader rev 5 on /dev/serial/by-id/pci-Bitcraze_AB_Crazyflie_BL_0-if00</span><br><span class="line">WARNING: Firmware not suitable <span class="keyword">for</span> this board (board_type=12 board_id=5)</span><br><span class="line">FORCED WRITE, FLASHING ANYWAY!</span><br><span class="line">ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff <span class="built_in">type</span>: ÿÿÿÿ</span><br><span class="line">idtype: =FF</span><br><span class="line">vid: ffffffff</span><br><span class="line">pid: ffffffff</span><br><span class="line">coa: //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8=</span><br><span class="line"></span><br><span class="line">sn: 002a00343432470d33363638</span><br><span class="line">chip: 10016413</span><br><span class="line">family: STM32F40x</span><br><span class="line">revision: Z</span><br><span class="line">flash 1032192</span><br><span class="line"></span><br><span class="line">Erase  : [====================] 100.0%</span><br><span class="line">Program: [====================] 100.0%</span><br><span class="line">Verify : [====================] 100.0%</span><br><span class="line">Rebooting.</span><br></pre></td></tr></table></figure>
<p>启动过程，如果固件加载ok，会启动px4主流程，Bootloader里面见main_f4.c，可用JLink调试是否运行至此。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* try to boot immediately */</span></span><br><span class="line">jump_to_app();</span><br></pre></td></tr></table></figure>
<p><br></p>
<h1 id="串口调试"><a href="#串口调试" class="headerlink" title="串口调试"></a>串口调试</h1><p>串口连接为PC10:E_TX1, PC11:E_RX1，连接usb转串口设备如下，当然我的外围设备都失败了。<br>关于引脚定义查找px4 board.h里面的源码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* E_TX1 / E_RX1 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GPIO_USART3_RX  GPIO_USART3_RX_2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GPIO_USART3_TX  GPIO_USART3_TX_2</span></span><br></pre></td></tr></table></figure>
<p>串口显示如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sercon: Registering CDC/ACM serial driver</span><br><span class="line">sercon: Successfully registered the CDC/ACM serial driver</span><br><span class="line">nsh: mount: mount failed: No such file or directory</span><br><span class="line">nsh: mkfatfs: mkfatfs failed: No such file or directory</span><br><span class="line">ERROR [mtd] failed to initialize EEPROM driver</span><br><span class="line">WARN  [param] selected parameter default file /fs/microsd/params</span><br><span class="line">WARN  [param] open failed <span class="string">'/fs/microsd/params'</span></span><br><span class="line">WARN  [modules__systemlib] failed to open param file: /fs/microsd/params</span><br><span class="line">WARN  [param] Param <span class="built_in">export</span> failed.</span><br><span class="line">nsh: rgbled: <span class="built_in">command</span> not found</span><br><span class="line">nsh: blinkm: <span class="built_in">command</span> not found</span><br><span class="line">  BAT_N_CELLS: curr: 0 -&gt; new: 3</span><br><span class="line">WARN  [modules__systemlib] failed to open param file: /fs/microsd/params</span><br><span class="line">WARN  [param] Param <span class="built_in">export</span> failed.</span><br><span class="line"></span><br><span class="line">NuttShell (NSH)</span><br><span class="line">nsh&gt; \0x1b</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/crazyflie/" rel="tag"># crazyflie</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/30/初学PX4之环境搭建/" rel="next" title="初学PX4之环境搭建">
                <i class="fa fa-chevron-left"></i> 初学PX4之环境搭建
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/03/说说保险/" rel="prev" title="说说保险">
                说说保险 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="nephen">
            
              <p class="site-author-name" itemprop="name">nephen</p>
              <p class="site-description motion-element" itemprop="description">学而不思则罔，思而不学则殆。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JLinkGDBServer调试"><span class="nav-number">1.</span> <span class="nav-text">JLinkGDBServer调试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开始GDB调试"><span class="nav-number">2.</span> <span class="nav-text">开始GDB调试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#下载代码"><span class="nav-number">3.</span> <span class="nav-text">下载代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#更新固件"><span class="nav-number">4.</span> <span class="nav-text">更新固件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#串口调试"><span class="nav-number">5.</span> <span class="nav-text">串口调试</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nephen</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
